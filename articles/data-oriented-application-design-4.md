---
title: "データ指向アプリケーションデザイン 4章 まとめ"
emoji: "🛳"
type: "idea"
topics: ["エンコード", "JSON", "ProtocolBuffers"]
published: true
---
# はじめに
データ指向アプリケーションデザインを読んでいるので自分の理解のためにメモをまとめます。  
概要では全体に書いてあること、詳細では概要のそれぞれの要素についてを書きます。  

# 概要
4章ではシステムに変更が起き、新旧のデータフォーマット、スキーマが共存した場合にJSON、Protocol Buffersなどのデータフォーマットがスキーマの変更にどのように対応するか、新旧のデータフォーマットが存在する場合にシステムをどうサポートするかを記載しています。  
データエンコーディングの方法としては3種類のパターンについての紹介を行います。    
1つ目がプログラミング言語固有のエンコーディングで、これはフォーマットが使用している言語に限定され、互換性を欠くことがあります。  
2つ目がJSON、XML、CSVなどのテキストフォーマットで、広く使用されておりデコードしなくとも人が理解できます。しかし、互換性は利用方法によること、データ型があいまいなため数字やバイナリ文字列を扱う場合は注意が必要です。  
3つ目がProtocol Buffersなどのスキーマを持つバイナリフォーマットで、デコードを行わないと人が読むことはできるませんが、コンパクトで効率的なエンコーディングを行うことができ、前方、後方互換性もサポートしています。  
それぞれのサービス、ノードでどのようなデータフォーマットが使われているかを理解することにより、システムの連携、変更をを安全に行うことができます。

# 詳細
- プログラミング言語固有のエンコーディング  
各プログラミング言語にはPythonのpickleのようにメモリ上のオブジェクトをバイトの並びにエンコードする機能があります。  
これらの手法は追加のライブラリを使う必要もなく手軽にエンコードを行うことができて便利ですが、他の言語でデータを読むのが難しい、データのバージョニングができないことが多いなどの特徴があります。  
またパフォーマンスやエンコード後のサイズの効率も悪いことが多いです。  


- XML、JSON、CSVなどのテキストフォーマット  
テキストフォーマットでのエンコーディング手法は様々なプログラミング言語でサポートされており、人がそのまま読むことができます。  
しかし、データ型があいまいであり、CSV、XMLでは数値と数字からなる文字列が区別できない、JSONでは整数値と浮動小数点を区別できません。  
またJSON、XMLはバイナリデータをサポートしていないため、Base64を使いエンコードを行いバイナリに含まれる特殊文字をエスケープする必要があります。  
データのエンコード語のサイズの効率でも大きなデータを扱う場合には文字列で各データを表す必要があるため大きな領域を使います。  


- Protocol Buffersなどのスキーマを持つバイナリフォーマット  
Protocol Buffersなどのスキーマを持つバイナリフォーマットは、各プログラミング言語でコードを生成するツールが提供されています。  
JSONなどのテキストフォーマットのエンコードに比べると使用する領域を少なくすることができ、スキーマの定義時に前方、後方互換性をサポートするための色々なオプションを指定することができます。  
ただしバイナリフォーマットのため人にはデータが読むことができないという欠点があります。  

